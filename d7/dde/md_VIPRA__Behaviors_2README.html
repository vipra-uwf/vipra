<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VIPRA Documentation: VIPRA Behaviors Development</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">VIPRA Documentation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">VIPRA Behaviors Development</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md196"></a> </p>
<h1><a class="anchor" id="autotoc_md197"></a>
Sections</h1>
<h3><a class="anchor" id="autotoc_md198"></a>
B. Behaviors</h3>
<h3><a class="anchor" id="autotoc_md199"></a>
S. Selectors</h3>
<h3><a class="anchor" id="autotoc_md200"></a>
A. Actions</h3>
<h3><a class="anchor" id="autotoc_md201"></a>
C. Conditions</h3>
<h3><a class="anchor" id="autotoc_md202"></a>
E. Events</h3>
<h3><a class="anchor" id="autotoc_md203"></a>
BB. Behavior Builder</h3>
<h3><a class="anchor" id="autotoc_md204"></a>
N. Needs</h3>
<hr  />
<h1><a class="anchor" id="autotoc_md206"></a>
B. Behaviors</h1>
<p>A <code>Behavior</code> describes <code>Actions</code> that pedestrians take given certain <code>Conditions</code></p>
<p>A <code>Behavior</code> is comprised of:</p><ul>
<li><code>Selectors</code></li>
<li><code>Events</code></li>
<li><code>Actions</code></li>
<li><code>Behavior Context</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md207"></a>
Example Behavior:</h3>
<p>This behavior describes an important announcement, while the announcement is occurring all pedestrians will walk at 50% speed. </p><div class="fragment"><div class="line">Consider an announcement_listener.</div>
<div class="line"> </div>
<div class="line">// Selector Statement</div>
<div class="line">Everyone is an announcement_listener.</div>
<div class="line"> </div>
<div class="line">// Event Definition</div>
<div class="line">An !announcement event will occur after 5 seconds from !start and end after 10 seconds from !announcement.</div>
<div class="line"> </div>
<div class="line">// Action Statement</div>
<div class="line">An announcement_listener will @walk 50% slower while an !announcement event is occurring.</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md208"></a>
Important Notes on Behaviors</h3>
<ol type="1">
<li>Each Behavior is self-contained, Behaviors know nothing of and can not interact with each other.</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md210"></a>
S. Selectors</h1>
<p><code>Selectors</code> Decide which pedestrians "possess" a <code>Behavior</code>.</p>
<p><code>Behaviors</code> only have one <code>Selector</code> but that <code>Selector</code> has multiple <code>SubSelectors</code>.</p>
<h2><a class="anchor" id="autotoc_md211"></a>
S.1. Sub Selectors</h2>
<p><code>SubSelectors</code> are what actually select pedestrians.</p>
<hr  />
 <h2><a class="anchor" id="autotoc_md213"></a>
S.2. Creating A Sub Selector</h2>
<ol type="1">
<li>Add To Grammar</li>
<li>Create Selector Definition</li>
<li>Add To BehaviorBuilder</li>
<li>Add Source To CMakeLists.txt</li>
<li>Add Tests</li>
<li>Add To Documentation</li>
</ol>
<h3><a class="anchor" id="autotoc_md214"></a>
S.2.1. Add To Grammar</h3>
<p><code>Selectors</code> are added to the grammar in <code>/VIPRA_Behaviors/grammar/selector.g4</code></p>
<p>After defining a new <code>SubSelector</code> grammar rule run <code>make</code> in <code>/VIPRA_Behaviors/grammar/</code> to update the generated files.</p>
<p>example: </p><div class="fragment"><div class="line">selector_Example:</div>
<div class="line">    &#39;An example Selector with a &#39; NUMBER &#39;.&#39;</div>
<div class="line">    ;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md215"></a>
S.2.2. Create Selector Function Definition</h3>
<p>Add a header file in <code>/VIPRA_Behaviors/include/selectors/</code> and a matching source file in <code>/VIPRA_Behaviors/src/selectors/</code></p>
<p>The only rule that <code>Selector Functions</code> need to conform to is that they implement </p><div class="fragment"><div class="line"> ++</div>
<div class="line">SelectorResult operator()(Behaviors::seed, <span class="keyword">const</span> std::vector&lt;VIPRA::idx&gt;&amp;, <span class="keyword">const</span> std::vector&lt;VIPRA::idx&gt;&amp;, <span class="keyword">const</span> PedestrianSet&amp;, <span class="keyword">const</span> ObstacleSet&amp;, <span class="keyword">const</span> Goals&amp;);</div>
</div><!-- fragment --><p>With the Parameters:</p><ol type="1">
<li>Randomization Seed</li>
<li>The Full Group of pedestrians</li>
<li>The Group of pedestrians that can be selected from</li>
<li>The Pedestrian Set</li>
<li>The Obstacle Set</li>
<li>The Goals</li>
</ol>
<p>example: </p><div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="comment">// selector_example.hpp</span></div>
<div class="line"><span class="keyword">struct </span>Selector_Example {</div>
<div class="line">  <span class="keywordtype">float</span> _f;</div>
<div class="line">  SelectorResult operator()(Behaviors::seed,</div>
<div class="line">                            <span class="keyword">const</span> std::vector&lt;VIPRA::idx&gt;&amp;,</div>
<div class="line">                            <span class="keyword">const</span> std::vector&lt;VIPRA::idx&gt;&amp;,</div>
<div class="line">                            <span class="keyword">const</span> PedestrianSet&amp;,</div>
<div class="line">                            <span class="keyword">const</span> ObstacleSet&amp;,</div>
<div class="line">                            <span class="keyword">const</span> Goals&amp;);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// selector_example.cpp</span></div>
<div class="line">SelectorResult operator()(Behaviors::seed,</div>
<div class="line">                            <span class="keyword">const</span> std::vector&lt;VIPRA::idx&gt;&amp;,</div>
<div class="line">                            <span class="keyword">const</span> std::vector&lt;VIPRA::idx&gt;&amp;,</div>
<div class="line">                            <span class="keyword">const</span> PedestrianSet&amp;,</div>
<div class="line">                            <span class="keyword">const</span> ObstacleSet&amp;,</div>
<div class="line">                            <span class="keyword">const</span> Goals&amp;) {</div>
<div class="line">    <span class="comment">// ... return the selected pedestrians</span></div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md216"></a>
S.2.3. Add To BehaviorBuilder</h3>
<div class="fragment"><div class="line"> ++</div>
<div class="line">SubSelector</div>
<div class="line">BehaviorBuilder::buildSubSelector(BehaviorParser::Ped_SelectorContext* ctx) {</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// ... Other Sub Selectors ...</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Add a block that creates the sub selector if the context matches</span></div>
<div class="line">  <span class="keywordflow">if</span> (selector-&gt;selector_Example()) {</div>
<div class="line">    <span class="keyword">const</span> VIPRA::size N = <span class="keyword">static_cast&lt;</span>VIPRA::size<span class="keyword">&gt;</span>(std::stoi(selector-&gt;selector_Example()-&gt;NUMBER()-&gt;toString()));</div>
<div class="line">    spdlog::debug(<span class="stringliteral">&quot;Behavior \&quot;{}\&quot;: Adding Selector: \&quot;Example\&quot; {} Are Ped Type: {}&quot;</span>,</div>
<div class="line">                  N,</div>
<div class="line">                  currentBehavior.getName(),</div>
<div class="line">                  groupStr,</div>
<div class="line">                  fmt::join(typeStrs, <span class="stringliteral">&quot;, &quot;</span>));</div>
<div class="line">    <span class="keywordflow">return</span> SubSelector{group, compType, required, selector_Example{N}};</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// ... Other Sub Selectors ...</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md217"></a>
S.2.4. Add Source To CMakeLists.txt</h3>
<p>Add the <code>Selector</code> source file to <code>/VIPRA_Behaviors/src/CMakeLists.txt</code></p>
<p>example:</p><ul>
<li>for our Example <code>Selector</code>: <code>${SRC_DIR}/selectors/selector_example.cpp</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md218"></a>
S.2.5. Add Tests</h3>
<p>Add any tests in <code>/VIPRA_Behaviors/__tests__/selector_tests/</code></p>
<h3><a class="anchor" id="autotoc_md219"></a>
S.2.6. Add To Documentation</h3>
<p>Add any documentation</p>
<hr  />
<h1><a class="anchor" id="autotoc_md221"></a>
A. Actions</h1>
<p><code>Actions</code> are what affect a Pedestrian's position, velocity, state, etc. <code>Actions</code> are comprised of <code>Atoms</code> and, optionally, a <code>Condition</code>.</p>
<h1><a class="anchor" id="autotoc_md222"></a>
A.1. Unconditional Actions</h1>
<p>An <code>Unconditional Action</code> will ALWAYS take effect.</p>
<p><code>Unconditional Actions</code> are described with the following rule: <code>A(n) {TYPE} will always {ATOM_LIST}.</code></p><ul>
<li>Type being the name given to pedestrians with the behavior</li>
<li>see <b>§A.3.1</b> for an explanation of Atom Lists</li>
</ul>
<hr  />
 <h1><a class="anchor" id="autotoc_md224"></a>
A.2. Conditional Actions</h1>
<p>A <code>Conditional Action</code> will only take effect if its <code>Condition</code> is satisfied.</p>
<p><code>Conditional Actions</code> are described with the following rule: <code>A(n) {TYPE} will {ATOM_LIST} {CONDITION}.</code></p><ul>
<li>Type being the name given to pedestrians with the behavior</li>
<li>see <b>§A.3.1</b> for an explanation of Atom Lists</li>
<li>see <b>§C.</b> for an explanation of Conditions</li>
</ul>
<hr  />
 <h1><a class="anchor" id="autotoc_md226"></a>
A.3 Atoms</h1>
<p><code>Atoms</code> are the part of an <code>Action</code> that actually affects a pedestrian. A group of <code>Atoms</code> (<code>Atom List</code>) comprise an <code>Action</code>.</p>
<p><code>Atoms</code> can be one or multiple words long and are always preceded by an <code>@</code></p>
<p>Examples:</p><ul>
<li><code>@stop</code></li>
<li><code>@walk 10% slower</code></li>
<li><code>@run in circles</code></li>
</ul>
<p><code>Atoms</code> derive from <code>/VIPRA_Behaviors/include/actions/action_atom.hpp :: Atom</code></p><ul>
<li><code>Atoms</code> can have one constructor, that may take any number of parameters</li>
<li><code>Atoms</code> must override <code>performAction</code></li>
</ul>
<hr  />
 <h2><a class="anchor" id="autotoc_md228"></a>
A.3.1 Atom List</h2>
<p>An <code>Atom List</code> is the collection of <code>Atoms</code> that make up an <code>Action</code>. <code>Atom Lists</code> are comprised of one or more <code>Atoms</code>.</p>
<p><code>Atom Lists</code> are described with the following rule: <code>{ATOM} (then {ATOM_LIST})</code></p>
<p>Examples:</p><ul>
<li><code>@stop</code></li>
<li><code>@stop then @listen</code></li>
<li><code>@stop then @listen then @run in circles</code></li>
</ul>
<p><b>Important Note:</b> <code>Atom</code> effects are applied in the order they are listed</p><ul>
<li>e.g The <code>Atom List</code> <code>@run in circles then @stop</code> might result in the pedestrian simply stopping *(dependent on the definition of @run in circles and @stop)*</li>
</ul>
<hr  />
 <h2><a class="anchor" id="autotoc_md230"></a>
A.3.2. Making An Atom</h2>
<ol type="1">
<li>Add To Grammar</li>
<li>Create Atom Definition</li>
<li>Add To BehaviorBuilder</li>
<li>Add Source To CMakeLists.txt</li>
<li>Add Tests</li>
<li>Add Documentation</li>
</ol>
<h3><a class="anchor" id="autotoc_md231"></a>
A.3.2.1. Add To Grammar</h3>
<p><code>Atoms</code> are added to the grammar in <code>/VIPRA_Behaviors/grammar/action.g4</code></p>
<p>After creating the <code>Atom</code> grammar rule run <code>make</code> in <code>/VIPRA_Behaviors/grammar/</code> to update the generated files.</p>
<p>example: </p><div class="fragment"><div class="line">// Don&#39;t forget to add the new rule to the action_atom rule</div>
<div class="line">action_atom:</div>
<div class="line">    ACTION |</div>
<div class="line">    action_Example</div>
<div class="line">    ;</div>
<div class="line"> </div>
<div class="line">// Defining the example atom rule</div>
<div class="line">action_Example:</div>
<div class="line">    &#39;@example do something with &#39; ID AND NUMBER;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md232"></a>
A.3.2.2. Create Atom Definition</h3>
<p>Create a header file in <code>/VIPRA_Behaviors/include/actions/atoms/</code> and a matching source file in <code>/VIPRA_Behaviors/src/actions/atoms/</code></p>
<p>The only rule that <code>Atoms</code> need to conform to is that they implement </p><div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keywordtype">void</span> operator()(PedestrianSet&amp;, ObstacleSet&amp;, Goals&amp;, BehaviorContext&amp;, VIPRA::idx, VIPRA::delta_t, std::shared_ptr&lt;VIPRA::State&gt;);</div>
</div><!-- fragment --><p> example: </p><div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="comment">// atom_example.hpp</span></div>
<div class="line"><span class="keyword">struct </span>Atom_Example {</div>
<div class="line">  <span class="keywordtype">float</span> _x;</div>
<div class="line">  std::string _str;</div>
<div class="line">  </div>
<div class="line">  <span class="keywordtype">void</span> operator()(PedestrianSet&amp;,</div>
<div class="line">                     ObstacleSet&amp;,</div>
<div class="line">                     Goals&amp;,</div>
<div class="line">                     BehaviorContext&amp;,</div>
<div class="line">                     VIPRA::idx,</div>
<div class="line">                     VIPRA::delta_t,</div>
<div class="line">                     std::shared_ptr&lt;VIPRA::State&gt;);</div>
<div class="line"> </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">//atom_example.cpp</span></div>
<div class="line">  Atom_Example::Atom_Example(<span class="keywordtype">float</span> x, std::string str) : _x(x), _str(str) {}</div>
<div class="line">  <span class="keywordtype">void</span> Atom_Example::operator()(PedestrianSet&amp;,</div>
<div class="line">                     ObstacleSet&amp;,</div>
<div class="line">                     Goals&amp;,</div>
<div class="line">                     BehaviorContext&amp;,</div>
<div class="line">                     VIPRA::idx,</div>
<div class="line">                     VIPRA::delta_t,</div>
<div class="line">                     std::shared_ptr&lt;VIPRA::State&gt;) {</div>
<div class="line">  <span class="comment">// ... code that writes changes to state</span></div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md233"></a>
A.3.2.3. Add To BehaviorBuilder</h3>
<p>Add the <code>Atom</code> to the <code>addAtomToAction</code> method in <code>/VIPRA_Behaviors/src/behavior/behavior_builder.cpp</code></p>
<p>example:</p><ul>
<li>for our Example <code>Atom</code>: <div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keywordtype">void</span> BehaviorBuilder::addAtomToAction(Action&amp;  action, BehaviorParser::Action_atomContext*  atom) {</div>
<div class="line">    <span class="comment">// ... other atoms ...</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check if the current rule context matches our example atom</span></div>
<div class="line">    <span class="keywordflow">if</span> (atom-&gt;action_Example()) {</div>
<div class="line">        spdlog::debug(<span class="stringliteral">&quot;Behavior \&quot;{}\&quot;: Adding Action Atom: \&quot;Example\&quot;&quot;</span>, currentBehavior.getName());</div>
<div class="line">        <span class="comment">// getting parameters from grammar rule</span></div>
<div class="line">        <span class="keywordtype">float</span> x = std::stof(atom-&gt;action_Example()-&gt;NUMBER()-&gt;toString());</div>
<div class="line">        std::string str = atom-&gt;action_Example()-&gt;ID()-&gt;toString();</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// add a newly constructed atom with the provided parameters</span></div>
<div class="line">        action.addAtom(Atom_Example{x, str});</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ... other atoms ...</span></div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>The function <code>ctx-&gt;action_Example()</code> comes from the name we gave the rule in the grammar</li>
</ul>
<h3><a class="anchor" id="autotoc_md234"></a>
A.3.2.4. Add Source To CMakeLists.txt</h3>
<p>Add the <code>Atom</code> source file to <code>/VIPRA_Behaviors/src/CMakeLists.txt</code></p>
<p>example:</p><ul>
<li>for our Example <code>Atom</code>: <code>${SRC_DIR}/actions/atoms/atom_example.cpp</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md235"></a>
A.3.2.5. Add Tests</h3>
<p>Add any tests in <code>/VIPRA_Behaviors/__tests__/atom_tests/</code></p>
<h3><a class="anchor" id="autotoc_md236"></a>
A.3.2.6. Add To Documentation</h3>
<p>Add any documentation</p>
<hr  />
<h1><a class="anchor" id="autotoc_md238"></a>
Conditions</h1>
<p>A <code>Condition</code> is what decides if a <code>Conditional Action</code> or <code>Event</code> occurs. <code>Conditions</code> are comprised of one or more <code>Sub Conditions</code> and the boolean operations between them (and/or).</p>
<p>Conditions are described by the rule: <code>{Sub Condition} (and|or {Sub Condition})*</code></p>
<hr  />
 <h1><a class="anchor" id="autotoc_md240"></a>
C.1. Sub Conditions</h1>
<p>A <code>Sub Condition</code> defines a single condition of the state of the simulation in which it returns true.</p>
<p>Each <code>Sub Condition</code> is described with its own grammar rule, check <code>/VIPRA_Behaviors/grammar/condition.g4</code> for them</p>
<hr  />
 <h2><a class="anchor" id="autotoc_md242"></a>
C.1.1. Combining Sub Conditions</h2>
<p>! currently boolean logic is only applied in the order the sub conditions are added ! ! there is no grouping subconditions e.g. (A &amp; !B &amp; C) vs (A &amp; !(B &amp; C)) !</p>
<p>When building <code>Conditions</code>, <code>Sub Conditions</code> are combined with either <code>and</code> or <code>or</code></p>
<hr  />
 <h2><a class="anchor" id="autotoc_md244"></a>
C.1.2. Making A Sub Condition</h2>
<ol type="1">
<li>Add To Grammar</li>
<li>Create Sub Condition Definition</li>
<li>Add To BehaviorBuilder</li>
<li>Add Source To CMakeLists.txt</li>
<li>Add Tests</li>
<li>Add Documentation</li>
</ol>
<h3><a class="anchor" id="autotoc_md245"></a>
C.1.2.1 Add To Grammar</h3>
<p><code>Sub Conditions</code> are added to the grammar in <code>/VIPRA_Behaviors/grammar/condition.g4</code></p>
<p>After creating the <code>SubCondition</code> grammar rule run <code>make</code> in <code>/VIPRA_Behaviors/grammar/</code> to update the generated files.</p>
<p>example: </p><div class="fragment"><div class="line">// don&#39;t forget to add to the sub condition rule</div>
<div class="line">sub_condition:</div>
<div class="line">    condition_Example |</div>
<div class="line">    *other conditions*</div>
<div class="line">    ;</div>
<div class="line"> </div>
<div class="line">// create new rule for the condition</div>
<div class="line">condition_Example:</div>
<div class="line">    &#39;this is and example condition&#39;</div>
<div class="line">    ;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md246"></a>
C.1.2.2. Create Sub Condition Definition</h3>
<p>Create a header file in <code>/VIPRA_Behaviors/include/conditions/subconditions/</code> and a matching source file in <code>/VIPRA_Behaviors/src/conditions/</code></p>
<p>The only rule that <code>SubConditions</code> need to conform to is that they implement </p><div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> PedestrianSet&amp;, <span class="keyword">const</span> ObstacleSet&amp;, <span class="keyword">const</span> Goals&amp;, <span class="keyword">const</span> BehaviorContext&amp;, VIPRA::idx, VIPRA::delta_t);</div>
</div><!-- fragment --><div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="comment">// subcondition_example.hpp</span></div>
<div class="line"><span class="keyword">struct </span>SubCondition_Example {</div>
<div class="line">  Behaviors::stateUID _s;</div>
<div class="line">  <span class="keywordtype">bool</span> _b;</div>
<div class="line">  <span class="keywordtype">bool</span> operator()(<span class="keyword">const</span> PedestrianSet&amp;, <span class="keyword">const</span> ObstacleSet&amp;, <span class="keyword">const</span> Goals&amp;, <span class="keyword">const</span> BehaviorContext&amp;, VIPRA::idx, VIPRA::delta_t);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// subcondtion_example.cpp</span></div>
<div class="line"><span class="keywordtype">bool</span></div>
<div class="line">SubCondition_Example::operator()(<span class="keyword">const</span> PedestrianSet&amp;,</div>
<div class="line">                               <span class="keyword">const</span> ObstacleSet&amp;,</div>
<div class="line">                               <span class="keyword">const</span> Goals&amp;,</div>
<div class="line">                               <span class="keyword">const</span> BehaviorContext&amp;,</div>
<div class="line">                               VIPRA::idx,</div>
<div class="line">                               VIPRA::delta_t) {</div>
<div class="line">    <span class="comment">// ... code to check if condition is met</span></div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md247"></a>
C.1.2.3. Add To BehaviorBuilder</h3>
<p>Add the <code>SubCondition</code> to the <code>addSubCondToCondtion</code> method in <code>/VIPRA_Behaviors/src/behavior/behavior_builder.cpp</code></p>
<p>example:</p><ul>
<li>for our Example <code>SubCondition</code>:</li>
</ul>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">BehaviorBuilder::addSubCondToCondtion(Condition&amp; condition, BehaviorParser::Sub_conditionContext* subcond) {</div>
<div class="line">    <span class="comment">// ... other subconditions ...</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check if the current rule context matches our example subcondition</span></div>
<div class="line">  <span class="keywordflow">if</span> (subcond-&gt;condition_Example()) {</div>
<div class="line">    spdlog::debug(<span class="stringliteral">&quot;Behavior \&quot;{}\&quot;: Adding SubCondition: Example&quot;</span>, currentBehavior.getName());</div>
<div class="line">    <span class="comment">// ... get parameters</span></div>
<div class="line">    condition.addSubCondition(SubCondition{stateParam, boolParam});</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">    <span class="comment">// ... other subconditions ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md248"></a>
C.1.2.4. Add Source To CMakeLists.txt</h3>
<p>Add the <code>SubCondition</code> source file to <code>/VIPRA_Behaviors/src/CMakeLists.txt</code></p>
<p>example:</p><ul>
<li>for our Example <code>SubCondition</code>: <code>${SRC_DIR}/conditions/subconditions/subcondition_example.cpp</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md249"></a>
C.1.2.5. Add Tests</h3>
<p>Add any tests in <code>/VIPRA_Behaviors/__tests__/subcondition_tests/</code></p>
<h3><a class="anchor" id="autotoc_md250"></a>
C.1.2.6. Add To Documentation</h3>
<p>Add any documentation</p>
<hr  />
 <h2><a class="anchor" id="autotoc_md252"></a>
C.1.3 Current Sub Conditions</h2>
<h3><a class="anchor" id="autotoc_md253"></a>
C.1.3.1 Elapsed Time:</h3>
<p><b>Parameters:</b></p><ul>
<li>VIPRA::delta_t : the desired elapsed time</li>
<li>Event* : pointer to event to listen to</li>
</ul>
<p><b>Evaluates to True, Given:</b> An <code>Event</code> has started and The elapsed time between the start and the current time step is greater or equal to the desired elapsed time</p>
<h3><a class="anchor" id="autotoc_md254"></a>
C.1.3.2 Event Occurring:</h3>
<p><b>Parameters:</b></p><ul>
<li>Event* : pointer to event to listen to</li>
</ul>
<p><b>Evaluates to True, Given:</b> The event has started and The event has not ended</p>
<h3><a class="anchor" id="autotoc_md255"></a>
C.1.3.3. Event:</h3>
<p><b>Parameters:</b></p><ul>
<li>Event* : pointer to the event to listen to</li>
</ul>
<p><b>Evaluates to True, Given:</b> The event has started</p>
<h3><a class="anchor" id="autotoc_md256"></a>
C.1.3.4. Start:</h3>
<p><b>Parameters:</b> none</p>
<p><b>Evaluates to True, Given:</b> Always</p>
<h3><a class="anchor" id="autotoc_md257"></a>
C.1.3.5 State:</h3>
<p>TODO : not implemented</p>
<p><b>Parameters:</b></p><ul>
<li>Behaviors::stateUID : the state to wait for</li>
<li>bool : true if the condition relies on a pedestrian's state, false if the condition relies on a the environment state</li>
</ul>
<p><b>Evaluates to True, Given:</b> The pedestrian or environments state is the same as the conditions required state</p>
<hr  />
<h1><a class="anchor" id="autotoc_md259"></a>
E. Events</h1>
<p>An <code>Event</code> is something that occurs during a simulation, for example an announcement or fire.</p>
<p>There are two kinds of events: <code>Single Fire</code> and <code>Lasting</code></p>
<p><code>Events</code> have a start <code>Condition</code> and, optional, end <code>Condition</code> When either the start <code>Condition</code> or end <code>Condition</code> its respective <code>Event Handlers</code> are called.</p>
<p>An <code>Event</code> can only be described once, if a <code>Behavior</code> file tries to redefine an <code>Event</code> of the same name a <code>Behavior Error</code> is thrown.</p>
<p>Events are always preceded by a <code>!</code> in the grammar ex. <code>!announcement</code></p>
<hr  />
 <h1><a class="anchor" id="autotoc_md261"></a>
E.1 Single Fire Events</h1>
<p><code>Single Fire Events</code> only have a start <code>Condition</code></p>
<p>When a <code>Single Fire Event</code> occurs, it calls its start <code>Event Handlers</code> and end <code>Event Handlers</code> in the same time step.</p>
<p>Single Fire <code>Events</code> are described by the rule: &lsquo;A(n) !{NAME} 'event will occur&rsquo; {CONDITION} '.';<code></p><ul>
<li>Name being the name of theEvent` and can be anything</li>
</ul>
<p></code></p>
<p><code></p><hr  />
<p> </code></p>
<h1><a class="anchor" id="autotoc_md263"></a>
E.2 Lasting Events</h1>
<p><code></code></p>
<p><code><code>Lasting Events</code> have a start <code>Condition</code> and end <code>Condition</code></code></p>
<p><code>When a <code>Lasting Event</code> occurs, it calls its start <code>Event Handlers</code>. A <code>Lasting Event</code> only calls its end <code>Event Handlers</code> when its end <code>Condition</code> returns true.</code></p>
<p><code><code>Lasting Events</code> are described by the rule: &lsquo;A(n) !{NAME} 'event will occur&rsquo; {CONDITION} 'and end' {CONDITION} '.';<code></p><ul>
<li>Name being the name of theEvent` and can be anything</li>
</ul>
<p></code></code></p>
<p><code><code></p><hr  />
<p> </code></code></p>
<h1><a class="anchor" id="autotoc_md265"></a>
E.3 Event Handlers</h1>
<p><code><code></code></code></p>
<p><code><code><code>Event Handlers</code> are the methods called when an <code>Event</code> either starts or ends.</code></code></p>
<p><code><code>Currently <code>Event Handlers</code> are simply typedef'd </p><div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="keyword">typedef</span>  std::function&lt;void(<span class="keywordtype">float</span>)&gt;  EventHandler;</div>
</div><!-- fragment --><p></code></code></p>
<p><code><code></code></code></p>
<h2><a class="anchor" id="autotoc_md266"></a>
E.3.1 Subscribing Handlers</h2>
<p><code><code></code></code></p>
<p><code><code>To subscribe an <code>Event Handler</code> to an <code>Event</code> use: </p><div class="fragment"><div class="line"> ++</div>
<div class="line">Event event(<span class="stringliteral">&quot;example&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// for an event start handler</span></div>
<div class="line"><span class="keyword">event</span>.onStart(startHandler);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// for an event end handler</span></div>
<div class="line"><span class="keyword">event</span>.onEnd(endHandler);</div>
</div><!-- fragment --><p></code></code></p>
<p><code><code></p><hr  />
<p> </code></code></p>
<h1><a class="anchor" id="autotoc_md268"></a>
E.4 Special Events</h1>
<p><code><code></code></code></p>
<p><code><code>Currently there is only one special event: the <code>!start</code> event</code></code></p>
<p><code><code>The <code>!start</code> event is in every <code>Behavior</code> and fires at the start of a simulation.</code></code></p>
<p><code><code></p><hr  />
<p></code></code></p>
<p><code><code></code></code></p>
<h1><a class="anchor" id="autotoc_md270"></a>
BB. Behavior Builder</h1>
<p><code><code></code></code></p>
<p><code><code>The <code>Behavior Builder</code> is what constructs <code>Behavior</code> objects from .behavior files.</code></code></p>
<p><code><code></p><hr  />
<p></code></code></p>
<p><code><code></code></code></p>
<h1><a class="anchor" id="autotoc_md272"></a>
V. Values</h1>
<p><code><code></code></code></p>
<p><code><code></code></code></p>
<h2><a class="anchor" id="autotoc_md273"></a>
V.1. Numerical Values</h2>
<p><code><code></code></code></p>
<p><code><code>Some <code>Conditions</code>, <code>Actions</code>, and <code>Events</code> require a numerical value to be provided in the <code>Behavior</code> file.</code></code></p>
<p><code><code></code></code></p>
<h3><a class="anchor" id="autotoc_md274"></a>
V.1.1. Static Values</h3>
<p><code><code></code></code></p>
<p><code><code>Numerical values can be provided as a static value.</code></code></p>
<p><code><code>For Example: </p><div class="fragment"><div class="line">An !announcement event will </div>
<div class="line">  occur after 10 seconds from !start.</div>
</div><!-- fragment --><p></code></code></p>
<p><code><code></code></code></p>
<h3><a class="anchor" id="autotoc_md275"></a>
V.1.2. Random Values</h3>
<p><code><code></code></code></p>
<p><code><code>Numerical values can also be defined as a range; either as Integers or Decimal values.</code></code></p>
<p><code><code>For Example: </p><div class="fragment"><div class="line">An !announcement event will </div>
<div class="line">  occur after a random 5.0 to 10.0 seconds from !start.</div>
</div><!-- fragment --><p> In this, the value will be chosen randomly from the values between 5.0 and 10.0 (inclusive).</code></code></p>
<p><code><code>Adding the decimal point to the number *(5.0)* means it will have a decimal value.</code></code></p>
<p><code><code>Without the decimal point *(5)* the values will be whole numbers.</code></code></p>
<p><code><code></p><hr  />
<p> </code></code></p>
<h1><a class="anchor" id="autotoc_md277"></a>
N. Needs</h1>
<p><code><code></code></code></p>
<p><code><code></code></code></p>
<h2><a class="anchor" id="autotoc_md278"></a>
N.1 Add Checks</h2>
<p><code><code> We may need to add checks that the what behaviors do is reasonable.</code></code></p>
<p><code><code>For example: Collisions detection, currently the change speed atom can cause pedestrians to fly through walls / go past their goals (only really an issue if they set the speed up to an unreasonable value)</code></code></p>
<p><code><code></code></code></p>
<h2><a class="anchor" id="autotoc_md279"></a>
N.2 Pedestrian Attributes</h2>
<p><code><code> We need a way to access pedestrian attributes, such as: state, speed, goal, etc.</code></code></p>
<p><code><code>example </p><div class="fragment"><div class="line">// conditional action based on the pedestrians state</div>
<div class="line">a pedestrian will @stop given their *state is #waiting.</div>
</div><!-- fragment --><p></code></code></p>
<p><code><code></code></code></p>
<h2><a class="anchor" id="autotoc_md280"></a>
N.3. Run Time Parameters</h2>
<p><code><code> We need a way to provide behaviors parameters at run time (taken from module params).</code></code></p>
<p><code><code>This is needed to allow for parameter sweeps</code></code></p>
<p><code><code>example </p><div class="fragment"><div class="line">// Parameter declaration</div>
<div class="line">PARAMETERS: $event_start, $event_length</div>
<div class="line"> </div>
<div class="line">// Parameter use</div>
<div class="line">The !announcement event will</div>
<div class="line">    start after $event_start seconds from !start</div>
<div class="line">    and end after $event_length seconds from !announcement.</div>
</div><!-- fragment --><p></code></code></p>
<p><code><code></code></code></p>
<h2><a class="anchor" id="autotoc_md281"></a>
N.4 Allow Behaviors To Change Goals</h2>
<p><code><code> We need a way for behaviors to change pedestrian goals.</code></code></p>
<p><code><code>This would require updating the Goals module to add a update pathfinding method</code></code></p>
<p><code><code>example </p><div class="fragment"><div class="line">a !fire will occur after 5 seconds from !start.</div>
<div class="line"> </div>
<div class="line">// the @head atom would change their goal and require a re-calc of pathfinding</div>
<div class="line">a pedestrian will @head towards the +exit nearest to them.</div>
</div><!-- fragment --><p></code></code></p>
<p><code><code></code></code></p>
<h2><a class="anchor" id="autotoc_md282"></a>
N.8. Conditional Selectors</h2>
<p><code><code> We need a way to select pedestrians based on conditions.</code></code></p>
<p><code><code>For example: choosing a pedestrians type based on their end goal</code></code></p>
<p><code><code></code></code></p>
<h2><a class="anchor" id="autotoc_md283"></a>
N.9. Individual Seeds for Actions/Selectors/Etc.</h2>
<p><code><code> We need to think about allowing different seeds for actions selectors and others.</code></code></p>
<p><code><code>For example: if a user wants to keep the same selected pedestrians but change other random aspects, they currently cannot as everything uses the one behavior seed.</code></code></p>
<p><code><code></code></code></p>
<h1><a class="anchor" id="autotoc_md284"></a>
W. Wants</h1>
<p><code><code></code></code></p>
<p><code><code></code></code></p>
<h2><a class="anchor" id="autotoc_md285"></a>
W.1. Sub Condition grouping / Operation Order</h2>
<p><code><code> We may need a way to group sub conditions with the equivalent of parenthesis, to provide more expressive conditions. Currently sub conditions are evaluated in the order they were added</code></code></p>
<p><code><code>example: <code>A &amp;&amp; (B || C)</code> vs <code>(A &amp;&amp; B) || C</code></code></code></p>
<p><code><code></code></code></p>
<h2><a class="anchor" id="autotoc_md286"></a>
W.2. Custom Action/Condition Definitions</h2>
<p><code><code> We may need a way for end users to specify <code>Atoms</code> and <code>Sub Conditions</code> in the <code>Behavior</code></code></code></p>
<p><code><code>example: </p><div class="fragment"><div class="line">// Action definition</div>
<div class="line">The @wait action means:</div>
<div class="line">    @be #waiting</div>
<div class="line"> </div>
<div class="line">// Atom in use</div>
<div class="line">A pedestrian will always @wait.</div>
</div><!-- fragment --><p></code></code></p>
<p><code><code></code></code></p>
<h3><a class="anchor" id="autotoc_md287"></a>
W.3. Behaviors Affect The Environment Physically</h3>
<p><code><code> We may need to add the ability for behaviors to add to the environment.</code></code></p>
<p><code><code>For example: a fire even can "place" fires around the map, then pedestrians can avoid these</code></code></p>
<p><code><code>Currently behaviors can only change the state of the environment</code></code></p>
<p><code><code></code></code></p>
<h1><a class="anchor" id="autotoc_md288"></a>
I. Issues</h1>
<p><code><code></code></code></p>
<p><code><code></p><hr  />
<p></code></code></p>
<p><code><code></code></code></p>
<h1><a class="anchor" id="autotoc_md290"></a>
Uc. Use Cases</h1>
<p><code><code></code></code></p>
<p><code><code></p><hr  />
<p></code></code></p>
<p><code><code>Most Important: Multiple Selectors - Finished Interaction Between Pedestrians Update Goals Individual events</code></code></p>
<p><code><code></p><hr  />
<p></code></code></p>
<p><code><code>Multiple Selectors: </p><pre class="fragment">Medical emergency (everyone waits for passenger to leave before moving)
  - multiple selectors (injured v normal)

Injured people may have to wait to disembark
  - multiple selectors

Disabled person - might need support
  - multiple selectors
  - interaction between pedestrians
  - changing goals?

A group of stationary folks with people moving around them (can make stationary people, but not move around)
  - multiple selectors
  - updating goals? (path around peds)
  - updating obstacle map? (add pedestrians as obstacle)
</pre> <hr  />
<p></code></code></p>
<p><code><code>Update Goals: </p><pre class="fragment">A group of stationary folks with people moving around them (can make stationary people, but not move around)
  - multiple selectors
  - updating goals? (path around peds)
  - updating obstacle map? (add pedestrians as obstacle)

Travel in a group
  - group selector
  - update goals?

Forget something (have to go back to get it)
  - updating goals

Disabled person - might need support
  - multiple selectors
  - interaction between pedestrians
  - changing goals?
</pre> <hr  />
<p></code></code></p>
<p><code><code>Change Propulsive Forces: </p><pre class="fragment">General fear of getting infection
  - change the propulsive forces?

Racial differences
  - change the propulsive forces? (allow to get closer)
</pre><p></code></code></p>
<p><code><code></p><hr  />
<p></code></code></p>
<p><code><code>Interaction Between Pedestrians: </p><pre class="fragment">Emergencies (Fire)
  - interaction between pedestrians (pushing)
  - allow climbing over obstacles?
  - update obstacle map?

Pushing slow/stopped walkers out of the way
  - interaction between pedestrians

Disabled person - might need support
  - multiple selectors
  - interaction between pedestrians
  - changing goals?
</pre> <hr  />
<p></code></code></p>
<p><code><code>Update Obstacle Set: </p><pre class="fragment">Emergencies (Fire)
      - interaction between pedestrians (pushing)
      - allow climbing over obstacles?
      - update obstacle map?

A group of stationary folks with people moving around them (can make stationary people, but not move around)
  - multiple selectors
  - updating goals? (path around peds)
  - updating obstacle map? (add pedestrians as obstacle)
</pre> <hr  />
<p></code></code></p>
<p><code><code>Misc: </p><pre class="fragment">Letting passengers in rows in front go first
  - condition for other passengers state
</pre><p></code></code></p>
<p><code><code></p><hr  />
<p></code></code></p>
<p><code><code>Not Sure About:</code></code></p>
<p><code><code>Responses influenced by religious or cultural beliefs and norms Unaccompanied minor Using precautionary or careful approach - self-protecting behavior risk-averse versus risk-seeking tendencies Misuse of intervention such as mask Sleep behaviors during a flight Conflict resolution </code></code></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
